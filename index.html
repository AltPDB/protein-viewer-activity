<!DOCTYPE html>
<html>
	<head>
		<title>Protein Viewer - AltPDB</title>
		<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
		<script src="lib/three.r74.min.js"></script>
		<script src="lib/altspace-0.16.0.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/async/1.5.2/async.min.js"></script>
		<script src="lib/glTF-loader.js"></script>
		<script src="js/PDBLoaderImproved.js"></script>
		<script src="js/utils.js"></script>

		<style>
			.bar {
				color: white;
				background-color: black;
				font-size: 18px;
				font-weight: bold;
				display: none;
			}

			.initialized .bar {
				display: block;
			}

			#other {
				display: none;
			}

			.isModerator #other {
				display: inline;
			}

			.item {
				display: inline-block;
				padding: 3px;


				background-color: black;
				color: white;
				text-decoration: none;
			}

			.item:hover {
				text-decoration: underline;
			}

			h1 {
				color: white;
			}

			form, form > input {
				font-size: 18px;
				color: white;
				background-color: black;
			}

			canvas {
				position: absolute;
				top: 0; left: 0;
				z-index: -1;
			}
		</style>

		<script>

			function toggleOptions(option, value)
			{
				function toggleOption(path, option, value)
				{
					var re = new RegExp('[&?]'+option+'(?:=([^&]+))?');
					var match = re.exec(path);

					if(match)
					{
						// remove option
						if(value === undefined || value === false)
							path = path.replace(match[0], '');
						// replace existing option unless new value is boolean
						else if(value !== true)
							path = path.replace(match[1], value);
					}
					else
					{
						// add boolean option
						if(value === undefined || value === true)
							path += '&'+option;
						// add key/value option
						else if(value !== false)
							path += '&'+option+'='+value;
					}

					path = '?' + path.slice(1);
					return path;
				}

				var path = window.location.search;
				if(option instanceof Object){
					for(var i in option){
						path = toggleOption(path, i, option[i]);
					}
				}
				else
				{
					path = toggleOption(path, option, value);
				}

				window.location.replace(path);
				return false;
			}

			function toggleCustomDialog(){
				var form = document.querySelector('form');
				if(form.style.display === 'none'){
					form.style.display = '';
					document.querySelector('a#other').style.color = '#87ceeb';
				}
				else {
					form.style.display = 'none';
					document.querySelector('a#other').style.color = '';
				}
				return false;
			}

			function constructUrl(evt){
				return toggleOptions({molecule: evt.target[0].value.toUpperCase(), noribbon: true, noball: false});
			}

		</script>
	</head>
	<body>
		<div class='bar'>
			<a href='javascript:;' onclick='return toggleCustomDialog();' class='item' id='other'>Load Protein from Protein Data Bank</a><br>
			<a href='?molecule=2VAA' onclick='return toggleOptions("molecule","2VAA");' class='item' id='2VAA'>&nbsp Example: Antigen Presenting Complex (2VAA)</a><br>
			<!-- <a href='?molecule=3UTQ' onclick='return toggleOptions("molecule","3UTQ");' class='item' id='3UTQ'>3UTQ</a> -->
			<!-- <a href='?molecule=4X5W' onclick='return toggleOptions("molecule","4X5W");' class='item' id='4X5W'>4X5W</a> -->
			<a href='?molecule=3WPG' onclick='return toggleOptions("molecule","3WPG");' class='item' id='3WPG'>&nbsp Example: Toll-like Receptor (3WPG)</a>
			<!-- <a href='?molecule=1J8H' onclick='return toggleOptions("molecule","1J8H");' class='item' id='1J8H'>APC with T-Cell Receptor (1J8H)</a><br> -->
			<!-- <a href='?molecule=1AQD' onclick='return toggleOptions("molecule","1AQD");' class='item' id='1AQD'>1AQD</a>  -->
			<!-- <a href='?molecule=2WBJ' onclick='return toggleOptions("molecule","2WBJ");' class='item' id='2WBJ'>2WBJ</a> -->

		</div>
		<form onsubmit='return constructUrl(event);' style='display:none;'>
			<span>Protein Data Bank ID: </span>
			<input name='mol' type='text' value='5B32'></input>
			<input type='submit' value='Go'></input>
		</form>
		<div class='bar'>
			<a href='javascript:;' onclick='return toggleOptions("noribbon");' class='item' id='ribbon'></a>
			<a href='javascript:;' onclick='return toggleOptions("noball");' class='item' id='ball'></a>
			Color bonds by:
			<a href='javascript:;' onclick='return toggleOptions("color");' class='item' id='nocolor'>None</a>
			<a href='javascript:;' onclick='return toggleOptions("color","chain");' class='item' id='chain'>Chains</a>
			<a href='javascript:;' onclick='return toggleOptions("color","structure");' class='item' id='structure'>Sub-Structures</a>
			<a href='javascript:;' onclick='return toggleOptions("color","residue");' class='item' id='residue'>AminoAcids</a>
		</div>
		<div style='text-align: center;' id='loading'>
			<img src='img/benzene-small.gif' alt='Loading'/>
			<h1>Loading...</h1>
		</div>
		<script src="js/present-model.js"></script>
		<script src="js/threejs-buttons.js"></script>
		<script>
			if (altspace.getUser) {
				altspace.getUser().then(function (user) {
					if (user.isModerator) { $(document.body).addClass('isModerator'); }
					$(document.body).addClass('initialized');
					addThreeJsButtons(user);
				}).catch(function (error) { console.error(error); });
			}
		</script>
	</body>
</html>
